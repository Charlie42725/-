// ======================================
// ğŸ—ï¸ ä¸€ç•ªè³ç¶²ç«™ Prisma Schema (for Supabase)
// Database: PostgreSQL (Supabase)
// Author: FuturiX Dev
// ======================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")   // ç”¨æ–¼æ‡‰ç”¨ç¨‹å¼é€£ç·šï¼ˆæœƒèµ° Supabase PgBouncerï¼‰
  directUrl = env("DIRECT_URL")     // ç”¨æ–¼ migration (ç›´é€£ port 5432)
}

// -----------------------------
// ğŸ”¹ å“ç‰Œ / IP
// -----------------------------
model Brand {
  id          Int       @id @default(autoincrement())
  name        String
  slug        String    @unique
  description String?
  logoUrl     String?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  series      Series[]
}

// -----------------------------
// ğŸ”¹ ç³»åˆ—
// -----------------------------
model Series {
  id          Int       @id @default(autoincrement())
  brand       Brand     @relation(fields: [brandId], references: [id], onDelete: Cascade)
  brandId     Int
  name        String
  slug        String
  description String?
  coverImage  String?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  products    Product[]

  @@unique([brandId, slug])
}

// -----------------------------
// ğŸ”¹ å•†å“
// -----------------------------
model Product {
  id               Int             @id @default(autoincrement())
  series           Series          @relation(fields: [seriesId], references: [id], onDelete: Cascade)
  seriesId         Int
  name             String
  slug             String
  shortDescription String?
  longDescription  String?
  price            Int
  totalTickets     Int             @default(0)
  soldTickets      Int             @default(0)
  status           ProductStatus   @default(draft)
  coverImage       String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt

  variants         ProductVariant[]
  images           Image[]
  logs             ProductLog[]

  @@unique([seriesId, slug])
}

// -----------------------------
// ğŸ”¹ å•†å“çé … / ç‰ˆæœ¬
// -----------------------------
model ProductVariant {
  id         Int       @id @default(autoincrement())
  product    Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId  Int
  prize      String    // è³ç­‰ (Aè³ã€Bè³ã€Cè³ã€Lastè³ç­‰)
  name       String    // çé …åç¨± (ç‰¹ç­‰çå…¬ä»”ã€é™å®šæµ·å ±ç­‰)
  rarity     String?   // ç¨€æœ‰åº¦ (SSR/SR/R/N)
  stock      Int       @default(0)
  imageUrl   String?
  isActive   Boolean   @default(true)
  createdAt  DateTime  @default(now())
}

// -----------------------------
// ğŸ”¹ åœ–ç‰‡åº«
// -----------------------------
model Image {
  id         Int       @id @default(autoincrement())
  product    Product?  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId  Int?
  url        String
  type       ImageType @default(gallery)
  sortOrder  Int       @default(0)
  createdAt  DateTime  @default(now())
}

// -----------------------------
// ğŸ”¹ å¾Œå°ç®¡ç†å“¡
// -----------------------------
model AdminUser {
  id            Int        @id @default(autoincrement())
  username      String     @unique
  passwordHash  String
  role          AdminRole  @default(editor)
  createdAt     DateTime   @default(now())

  logs          ProductLog[]
}

// -----------------------------
// ğŸ”¹ å•†å“æ“ä½œç´€éŒ„ (ä¸Šæ¶ / ä¸‹æ¶ / æ›´æ–°)
// -----------------------------
model ProductLog {
  id         Int         @id @default(autoincrement())
  product    Product?    @relation(fields: [productId], references: [id], onDelete: SetNull)
  productId  Int?
  admin      AdminUser?  @relation(fields: [adminId], references: [id], onDelete: SetNull)
  adminId    Int?
  action     String
  message    String?
  createdAt  DateTime    @default(now())
}

// -----------------------------
// ğŸ”¸ ENUM å®šç¾©
// -----------------------------
enum ProductStatus {
  draft
  active
  sold_out
  archived
}

enum ImageType {
  cover
  gallery
  variant
}

enum AdminRole {
  admin
  editor
}
